set(COMMON_INCLUDE_DIRECTORIES
  ${DCMTK_INCLUDE_DIRS}
  ${ITK_INCLUDE_DIRS}
  ${ITK_INSTALL_PREFIX}/include/vxl/core
  ${ITK_INSTALL_PREFIX}/include/vxl/vcl
  )

set(COMMON_TARGET_LIBRARIES
  ${DCMTK_LIBRARIES}
  ${ITK_LIBRARIES}
  )

set(MODULE_NAME segimage2itkimage)

set(MODULE_SRCS
  ${MODULE_NAME}.cxx
  ${CMAKE_SOURCE_DIR}/jsoncpp/jsoncpp.cpp
  )

SEMMacroBuildCLI(
  NAME ${MODULE_NAME}
  INCLUDE_DIRECTORIES ${COMMON_INCLUDE_DIRECTORIES}
  ADDITIONAL_SRCS ${MODULE_SRCS}
  TARGET_LIBRARIES ${COMMON_TARGET_LIBRARIES}
  RUNTIME_OUTPUT_DIRECTORY        "${CMAKE_RUNTIME_OUTPUT_DIRECTORY}"
  LIBRARY_OUTPUT_DIRECTORY        "${CMAKE_LIBRARY_OUTPUT_DIRECTORY}"
  ARCHIVE_OUTPUT_DIRECTORY        "${CMAKE_ARCHIVE_OUTPUT_DIRECTORY}"
  INSTALL_RUNTIME_DESTINATION ${CMAKE_BINARY_DIR}
  INSTALL_LIBRARY_DESTINATION ${CMAKE_BINARY_DIR}
  INSTALL_ARCHIVE_DESTINATION ${CMAKE_BINARY_DIR}
  )

add_test(NAME ${MODULE_NAME}_hello
   COMMAND ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/${MODULE_NAME} --help)
add_test(NAME ${MODULE_NAME}_makeNRRD
   COMMAND ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/${MODULE_NAME}
   ${CMAKE_SOURCE_DIR}/data/ct-3slice/liver.dcm
   ${TEMP_DIR})


set(MODULE_NAME itkimage2segimage)

set(MODULE_SRCS
  ${MODULE_NAME}.cxx
  ${CMAKE_SOURCE_DIR}/jsoncpp/jsoncpp.cpp
  QIICRUIDs.h
  )

SEMMacroBuildCLI(
  NAME ${MODULE_NAME}
  INCLUDE_DIRECTORIES ${COMMON_INCLUDE_DIRECTORIES}
  ADDITIONAL_SRCS ${MODULE_SRCS}
  TARGET_LIBRARIES ${COMMON_TARGET_LIBRARIES}
  RUNTIME_OUTPUT_DIRECTORY        "${CMAKE_RUNTIME_OUTPUT_DIRECTORY}"
  LIBRARY_OUTPUT_DIRECTORY        "${CMAKE_LIBRARY_OUTPUT_DIRECTORY}"
  ARCHIVE_OUTPUT_DIRECTORY        "${CMAKE_ARCHIVE_OUTPUT_DIRECTORY}"
  INSTALL_RUNTIME_DESTINATION ${CMAKE_BINARY_DIR}
  INSTALL_LIBRARY_DESTINATION ${CMAKE_BINARY_DIR}
  INSTALL_ARCHIVE_DESTINATION ${CMAKE_BINARY_DIR}
  )

add_test(NAME ${MODULE_NAME}_hello
         COMMAND ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/${MODULE_NAME} --help)
add_test(NAME ${MODULE_NAME}_makeSEG
         COMMAND ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/${MODULE_NAME}
         --seriesNumber 1 --seriesDescription "Liver Segmentation"
         --labelAttributesFiles ${CMAKE_SOURCE_DIR}/doc/sample.info
         --segImageFiles ${CMAKE_SOURCE_DIR}/data/ct-3slice/liver_seg.nrrd
         --dicomImageFiles ${CMAKE_SOURCE_DIR}/data/ct-3slice/01.dcm,${CMAKE_SOURCE_DIR}/data/ct-3slice/02.dcm,${CMAKE_SOURCE_DIR}/data/ct-3slice/03.dcm
         --segDICOMFile ${TEMP_DIR}/liver.dcm
       )
